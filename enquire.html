<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Titans Academy Enquiry Portal</title>
    <style>
        body { font-family: sans-serif; background-color: #f4f4f9; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        h2 { text-align: center; color: #007bff; }
        
        /* Form Inputs */
        input, select { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 16px; }
        label { font-weight: bold; display: block; margin-bottom: 5px; }

        /* Buttons */
        .btn { width: 100%; padding: 12px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; color: white; font-weight: bold; }
        .btn-submit { background-color: #28a745; margin-bottom: 10px; }
        .btn-submit:hover { background-color: #218838; }
        .btn-delete { background-color: #dc3545; padding: 5px 10px; font-size: 14px; width: auto; }

        /* Status Messages */
        #status { text-align: center; margin-top: 10px; font-weight: bold; }
        .error { color: red; background: #ffe6e6; padding: 10px; border-radius: 4px; display: none; }
        .success { color: green; }

        /* Table */
        .table-container { margin-top: 30px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 500px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #007bff; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }
    </style>
</head>
<body>

<div class="container">
    <h2>Chess Titans Academy Enquiry Form</h2>

    <div id="errorBox" class="error">
        ‚ö†Ô∏è <strong>Connection Failed!</strong><br>
        1. Check your internet.<br>
        2. Ensure Google Script is deployed as <b>"Anyone"</b>.<br>
        3. Check if the URL is correct.
    </div>

    <form id="myForm">
        <label>Name</label>
        <input type="text" id="name" placeholder="Student Name" required>

        <label>Contact</label>
        <input type="tel" id="contact" placeholder="Phone Number" required>

        <label>Branch</label>
        <select id="branch" required>
            <option value="">-- Select --</option>
            <option value="Iyyappanthangal">Iyyappanthangal</option>
            <option value="Mangadu">Mangadu</option>
            <option value="Online">Online Class</option>
        </select>

        <label>Date</label>
        <input type="date" id="date" required>

        <button type="submit" class="btn btn-submit">Submit Enquiry</button>
    </form>
    
    <div id="status"></div>

    <div class="table-container">
        <h3>Enquiry List <button onclick="loadData()" style="float:right; font-size:12px; padding:5px;">Refresh</button></h3>
        <table id="dataTable">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Name</th>
                    <th>Contact</th>
                    <th>Branch</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <tr><td colspan="5" style="text-align:center;">Loading...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    // ==========================================
    // üî¥ PASTE YOUR NEW URL HERE INSIDE QUOTES
    // ==========================================
    const APP_URL = 'https://script.google.com/macros/s/AKfycbygN5X8Mvpz3EIqjpoNqmqViCZhOu92yekB0n7Bn83Wtf0t2dant3dDK8Ebay5RyTgb7Q/exec'; 
    // ==========================================

    const form = document.getElementById('myForm');
    const statusDiv = document.getElementById('status');
    const errorBox = document.getElementById('errorBox');

    // 1. SUBMIT DATA
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        statusDiv.innerHTML = "‚è≥ Saving...";
        errorBox.style.display = 'none';

        const data = {
            action: "add",
            name: document.getElementById('name').value,
            contact: document.getElementById('contact').value,
            branch: document.getElementById('branch').value,
            enquiryDate: document.getElementById('date').value
        };

        fetch(APP_URL, {
            method: "POST",
            body: JSON.stringify(data)
        })
        .then(res => res.json())
        .then(response => {
            if(response.result === "success") {
                statusDiv.innerHTML = "<span class='success'>‚úÖ Saved!</span>";
                form.reset();
                loadData(); // Reload table
            } else {
                throw new Error(response.error);
            }
        })
        .catch(err => {
            console.error(err);
            statusDiv.innerHTML = "";
            errorBox.style.display = 'block';
            errorBox.innerHTML = "‚ö†Ô∏è Error: " + err.message;
        });
    });

    // 2. LOAD DATA
    function loadData() {
        const tbody = document.getElementById('tableBody');
        
        fetch(APP_URL)
        .then(res => res.json())
        .then(data => {
            tbody.innerHTML = ""; // Clear loader
            
            if(data.length === 0) {
                tbody.innerHTML = "<tr><td colspan='5' style='text-align:center'>No records found</td></tr>";
                return;
            }

            // Reverse to show newest first
            data.reverse().forEach(row => {
                // Format date safely
                let dateDisplay = row.enquiryDate;
                try { dateDisplay = new Date(row.enquiryDate).toLocaleDateString(); } catch(e){}

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${dateDisplay}</td>
                    <td>${row.name}</td>
                    <td>${row.contact}</td>
                    <td>${row.branch}</td>
                    <td><button class="btn btn-delete" onclick="deleteItem('${row.id}')">Delete</button></td>
                `;
                tbody.appendChild(tr);
            });
        })
        .catch(err => {
            console.error(err);
            tbody.innerHTML = "<tr><td colspan='5' style='text-align:center; color:red;'>Failed to load data. Check URL.</td></tr>";
        });
    }

    // 3. DELETE DATA
    window.deleteItem = function(id) {
        if(!confirm("Delete this?")) return;
        
        fetch(APP_URL, {
            method: "POST",
            body: JSON.stringify({ action: "delete", id: id })
        })
        .then(res => res.json())
        .then(() => loadData())
        .catch(err => alert("Delete failed"));
    };

    // Load on start
    loadData();

</script>

</body>
</html>
